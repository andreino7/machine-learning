__author__ = 'Filippo'

import csv
import datetime

def weekFromDate(date):
    d = date.replace("-","")
    return datetime.datetime.strptime(d, "%Y%m%d").isocalendar()[1]


clients = {}
for i in range(52):
    clients[i+1] = {}
    for j in range(7):
        clients[i+1][j+1] = []
data=[]
store={}
storeMean = {1: 4759, 2: 4953, 3: 6942, 4: 9638, 5: 4676, 6: 5509, 7: 8817, 8: 5539, 9: 6562, 10: 5568, 11: 8030, 12: 7589, 13: 5034, 14: 5508, 15: 6672, 16: 7680, 17: 6335, 18: 6560, 19: 6464, 20: 7756, 21: 5482, 22: 4525, 23: 5520, 24: 9388, 25: 11168, 26: 6671, 27: 9478, 28: 5313, 29: 7364, 30: 5294, 31: 5862, 32: 4067, 33: 8436, 34: 8031, 35: 9703, 36: 9363, 37: 7114, 38: 6004, 39: 4852, 40: 4902, 41: 5335, 42: 10178, 43: 6822, 44: 5478, 45: 5348, 46: 5352, 47: 7145, 48: 3934, 49: 7304, 50: 4256, 51: 6675, 52: 7407, 53: 5264, 54: 7907, 55: 4598, 56: 7321, 57: 10605, 58: 6336, 59: 5501, 60: 8033, 61: 4722, 62: 6503, 63: 6956, 64: 10359, 65: 5112, 66: 6114, 67: 7828, 68: 7563, 69: 9426, 70: 6608, 71: 9061, 72: 4420, 73: 4576, 74: 6256, 75: 6023, 76: 8999, 77: 7621, 78: 3717, 79: 5474, 80: 7616, 81: 6985, 82: 9019, 83: 3887, 84: 12955, 85: 7272, 86: 4695, 87: 5865, 88: 6024, 89: 5971, 90: 8416, 91: 5559, 92: 5996, 93: 5965, 94: 7121, 95: 7638, 96: 5176, 97: 6703, 98: 5109, 99: 5130, 100: 7964, 101: 7469, 102: 7079, 103: 4689, 104: 10126, 105: 4441, 106: 8668, 107: 7336, 108: 11035, 109: 6464, 110: 4534, 111: 6771, 112: 6229, 113: 7199, 114: 5346, 115: 7371, 116: 7294, 117: 3881, 118: 7781, 119: 6005, 120: 7110, 121: 4453, 122: 6462, 123: 8399, 124: 4424, 125: 11836, 126: 6507, 127: 5238, 128: 7454, 129: 9208, 130: 5121, 131: 5275, 132: 6283, 133: 6467, 134: 4725, 135: 5952, 136: 5488, 137: 8274, 138: 7334, 139: 6464, 140: 7469, 141: 5540, 142: 4603, 143: 6314, 144: 7718, 145: 8342, 146: 7812, 147: 8212, 148: 8638, 149: 5567, 150: 8417, 151: 6755, 152: 5541, 153: 7066, 154: 8737, 155: 6886, 156: 6961, 157: 9722, 158: 8156, 159: 7748, 160: 5730, 161: 7252, 162: 7768, 163: 7298, 164: 6210, 165: 3996, 166: 5819, 167: 9295, 168: 7517, 169: 7218, 170: 5009, 171: 8429, 172: 6981, 173: 8232, 174: 5936, 175: 5784, 176: 5278, 177: 3994, 178: 10089, 179: 7295, 180: 7220, 181: 6382, 182: 5304, 183: 4821, 184: 6594, 185: 7170, 186: 3783, 187: 6279, 188: 4986, 189: 8762, 190: 7198, 191: 6838, 192: 9016, 193: 5362, 194: 4829, 195: 10713, 196: 5216, 197: 6846, 198: 2900, 199: 7955, 200: 7729, 201: 5249, 202: 6065, 203: 6775, 204: 5486, 205: 6536, 206: 7157, 207: 11184, 208: 2936, 209: 5587, 210: 3193, 211: 12994, 212: 4775, 213: 8131, 214: 9331, 215: 6313, 216: 7226, 217: 4700, 218: 5018, 219: 3133, 220: 4906, 221: 5821, 222: 4982, 223: 7232, 224: 6629, 225: 5197, 226: 7257, 227: 6028, 228: 7946, 229: 8645, 230: 7561, 231: 4770, 232: 3376, 233: 9431, 234: 11072, 235: 5935, 236: 7119, 237: 4535, 238: 7671, 239: 5071, 240: 4812, 241: 6583, 242: 4093, 243: 7074, 244: 5271, 245: 8897, 246: 7081, 247: 8576, 248: 8362, 249: 5285, 250: 8470, 251: 19123, 252: 10615, 253: 5746, 254: 3005, 255: 6271, 256: 9832, 257: 5335, 258: 5642, 259: 11656, 260: 6559, 261: 12616, 262: 20718, 263: 3707, 264: 7234, 265: 4954, 266: 4389, 267: 9289, 268: 4881, 269: 9346, 270: 9291, 271: 7841, 272: 6237, 273: 7059, 274: 4070, 275: 7443, 276: 4091, 277: 6444, 278: 7142, 279: 8881, 280: 6267, 281: 5860, 282: 4408, 283: 7114, 284: 5413, 285: 5154, 286: 4927, 287: 8152, 288: 5625, 289: 6321, 290: 7014, 291: 8023, 292: 5774, 293: 6257, 294: 5770, 295: 5285, 296: 6963, 297: 6992, 298: 8398, 299: 6235, 300: 7077, 301: 5538, 302: 3742, 303: 6188, 304: 7067, 305: 5347, 306: 4368, 307: 2703, 308: 9353, 309: 6971, 310: 8236, 311: 6638, 312: 5568, 313: 7075, 314: 5137, 315: 4252, 316: 9855, 317: 5379, 318: 7527, 319: 7787, 320: 14834, 321: 5958, 322: 5021, 323: 7365, 324: 5687, 325: 6484, 326: 5008, 327: 7738, 328: 4432, 329: 6912, 330: 4166, 331: 6160, 332: 3728, 333: 9773, 334: 5428, 335: 13313, 336: 13910, 337: 5049, 338: 7217, 339: 5147, 340: 6485, 341: 5511, 342: 11104, 343: 7199, 344: 8481, 345: 4559, 346: 6830, 347: 4804, 348: 8802, 349: 8159, 350: 7013, 351: 6046, 352: 6692, 353: 5651, 354: 8390, 355: 9148, 356: 5719, 357: 7805, 358: 10306, 359: 6851, 360: 6935, 361: 6266, 362: 9376, 363: 7134, 364: 4564, 365: 5440, 366: 6196, 367: 5254, 368: 9686, 369: 6856, 370: 7649, 371: 6889, 372: 8786, 373: 4530, 374: 7009, 375: 9164, 376: 8460, 377: 7818, 378: 6324, 379: 3902, 380: 14456, 381: 9001, 382: 7985, 383: 17294, 384: 8871, 385: 7348, 386: 8029, 387: 9374, 388: 10257, 389: 10337, 390: 11568, 391: 5727, 392: 7279, 393: 5903, 394: 8353, 395: 3989, 396: 10222, 397: 5574, 398: 5496, 399: 5558, 400: 8745, 401: 7026, 402: 5857, 403: 7468, 404: 4785, 405: 4520, 406: 6111, 407: 3886, 408: 4727, 409: 5527, 410: 6443, 411: 9133, 412: 9102, 413: 7058, 414: 6427, 415: 6234, 416: 11012, 417: 7633, 418: 5275, 419: 5311, 420: 4540, 421: 9588, 422: 4559, 423: 10828, 424: 6925, 425: 3237, 426: 5068, 427: 7643, 428: 6287, 429: 5321, 430: 8632, 431: 9524, 432: 10982, 433: 5360, 434: 9904, 435: 3277, 436: 5509, 437: 7366, 438: 5153, 439: 7294, 440: 5156, 441: 6328, 442: 4379, 443: 5251, 444: 12188, 445: 8600, 446: 4932, 447: 5307, 448: 8484, 449: 11253, 450: 8790, 451: 5439, 452: 5149, 453: 7775, 454: 5794, 455: 7371, 456: 6190, 457: 4840, 458: 7582, 459: 9176, 460: 3736, 461: 4838, 462: 4832, 463: 6094, 464: 10642, 465: 7762, 466: 7712, 467: 13480, 468: 6669, 469: 11901, 470: 13111, 471: 7109, 472: 5204, 473: 3552, 474: 7526, 475: 6473, 476: 5851, 477: 6213, 478: 6806, 479: 11230, 480: 4935, 481: 5155, 482: 8334, 483: 4948, 484: 7717, 485: 4871, 486: 4266, 487: 6999, 488: 3686, 489: 7306, 490: 8249, 491: 6746, 492: 7859, 493: 8295, 494: 7649, 495: 5154, 496: 7728, 497: 9062, 498: 6996, 499: 5155, 500: 5354, 501: 5378, 502: 10823, 503: 6698, 504: 6673, 505: 4776, 506: 7581, 507: 8455, 508: 6767, 509: 6125, 510: 8196, 511: 5662, 512: 5510, 513: 18179, 514: 5756, 515: 9058, 516: 5879, 517: 5962, 518: 5865, 519: 5306, 520: 3869, 521: 5181, 522: 8222, 523: 15530, 524: 7710, 525: 10233, 526: 10630, 527: 10734, 528: 10704, 529: 7823, 530: 4634, 531: 4901, 532: 10894, 533: 9659, 534: 7519, 535: 8115, 536: 8323, 537: 5580, 538: 3859, 539: 11310, 540: 5648, 541: 6720, 542: 6246, 543: 2790, 544: 14094, 545: 10635, 546: 13681, 547: 5752, 548: 5073, 549: 4642, 550: 5973, 551: 6559, 552: 7721, 553: 7038, 554: 4481, 555: 5173, 556: 7178, 557: 4383, 558: 3241, 559: 5882, 560: 13612, 561: 6913, 562: 17969, 563: 5513, 564: 5528, 565: 6636, 566: 4904, 567: 5241, 568: 4877, 569: 4519, 570: 4535, 571: 7742, 572: 6888, 573: 3974, 574: 8898, 575: 5367, 576: 6982, 577: 4953, 578: 8164, 579: 8294, 580: 10197, 581: 5333, 582: 7023, 583: 4311, 584: 4734, 585: 5675, 586: 15131, 587: 9663, 588: 6154, 589: 4678, 590: 4984, 591: 5700, 592: 4448, 593: 9507, 594: 4155, 595: 15019, 596: 4505, 597: 5080, 598: 5892, 599: 9769, 600: 6996, 601: 4875, 602: 6300, 603: 6933, 604: 7963, 605: 7026, 606: 5839, 607: 3901, 608: 9326, 609: 4638, 610: 4197, 611: 5792, 612: 6816, 613: 6728, 614: 6590, 615: 9712, 616: 8487, 617: 6359, 618: 6830, 619: 4303, 620: 7773, 621: 5916, 622: 4317, 623: 7146, 624: 7019, 625: 6300, 626: 9382, 627: 5991, 628: 6231, 629: 7652, 630: 6935, 631: 5400, 632: 7028, 633: 7207, 634: 6713, 635: 5909, 636: 5927, 637: 8707, 638: 6009, 639: 4734, 640: 11533, 641: 5764, 642: 3652, 643: 7994, 644: 9353, 645: 10730, 646: 5025, 647: 5774, 648: 6573, 649: 3683, 650: 6391, 651: 7615, 652: 6637, 653: 5915, 654: 6475, 655: 8031, 656: 3245, 657: 6054, 658: 6058, 659: 5643, 660: 4616, 661: 7166, 662: 8439, 663: 4792, 664: 4946, 665: 8228, 666: 7016, 667: 8786, 668: 8940, 669: 4514, 670: 6589, 671: 5935, 672: 8837, 673: 7126, 674: 8204, 675: 4278, 676: 7687, 677: 7938, 678: 7299, 679: 9943, 680: 5205, 681: 3566, 682: 11207, 683: 9147, 684: 7721, 685: 6630, 686: 6250, 687: 8372, 688: 3615, 689: 7046, 690: 5589, 691: 8371, 692: 6588, 693: 6607, 694: 8047, 695: 5393, 696: 7850, 697: 10656, 698: 15564, 699: 8331, 700: 4362, 701: 5778, 702: 4373, 703: 3290, 704: 10393, 705: 7967, 706: 5743, 707: 8319, 708: 4578, 709: 9886, 710: 4546, 711: 6914, 712: 6421, 713: 10718, 714: 4553, 715: 6491, 716: 5717, 717: 5552, 718: 7911, 719: 5383, 720: 7166, 721: 7673, 722: 9836, 723: 7032, 724: 6812, 725: 5747, 726: 11048, 727: 4529, 728: 5245, 729: 10548, 730: 8055, 731: 9249, 732: 5816, 733: 14933, 734: 5980, 735: 5518, 736: 5244, 737: 6117, 738: 8508, 739: 9557, 740: 6978, 741: 7619, 742: 8025, 743: 3816, 744: 7457, 745: 7499, 746: 6039, 747: 8027, 748: 5737, 749: 5189, 750: 4997, 751: 4216, 752: 5251, 753: 8710, 754: 8086, 755: 10483, 756: 16574, 757: 6219, 758: 4868, 759: 7010, 760: 7638, 761: 8729, 762: 3891, 763: 6125, 764: 3538, 765: 8506, 766: 6123, 767: 6023, 768: 12991, 769: 10825, 770: 6477, 771: 6722, 772: 3582, 773: 5716, 774: 5493, 775: 8690, 776: 4804, 777: 3991, 778: 5901, 779: 7128, 780: 6547, 781: 4922, 782: 5488, 783: 6860, 784: 7751, 785: 6511, 786: 3563, 787: 10227, 788: 17961, 789: 3380, 790: 7453, 791: 7668, 792: 7389, 793: 4832, 794: 3083, 795: 4553, 796: 7244, 797: 4208, 798: 7468, 799: 9894, 800: 5337, 801: 4845, 802: 6841, 803: 6047, 804: 4922, 805: 6084, 806: 6808, 807: 9820, 808: 7291, 809: 9393, 810: 5930, 811: 4132, 812: 6366, 813: 5810, 814: 8476, 815: 8395, 816: 5133, 817: 21757, 818: 6110, 819: 6091, 820: 12085, 821: 6937, 822: 7737, 823: 5802, 824: 6834, 825: 4562, 826: 8839, 827: 12771, 828: 5199, 829: 5920, 830: 6174, 831: 12689, 832: 6550, 833: 5511, 834: 5868, 835: 5188, 836: 5906, 837: 3473, 838: 7987, 839: 5127, 840: 7319, 841: 2972, 842: 18574, 843: 9468, 844: 4178, 845: 4828, 846: 9224, 847: 7111, 848: 6630, 849: 8155, 850: 6201, 851: 5453, 852: 4606, 853: 9243, 854: 6577, 855: 5762, 856: 7142, 857: 7446, 858: 4755, 859: 7503, 860: 5781, 861: 3500, 862: 8565, 863: 7707, 864: 4268, 865: 7566, 866: 6873, 867: 4329, 868: 9578, 869: 5973, 870: 6929, 871: 6260, 872: 8536, 873: 3833, 874: 4583, 875: 5061, 876: 9228, 877: 6331, 878: 8720, 879: 3762, 880: 7507, 881: 4203, 882: 6615, 883: 4768, 884: 5536, 885: 5458, 886: 6442, 887: 6896, 888: 7998, 889: 4144, 890: 5729, 891: 7976, 892: 7599, 893: 6396, 894: 8468, 895: 9329, 896: 6937, 897: 3492, 898: 6615, 899: 5268, 900: 5844, 901: 7231, 902: 4886, 903: 11737, 904: 6016, 905: 8530, 906: 10929, 907: 6270, 908: 4234, 909: 10728, 910: 5708, 911: 9884, 912: 5765, 913: 8892, 914: 9506, 915: 6338, 916: 5382, 917: 6702, 918: 5187, 919: 5536, 920: 5764, 921: 9473, 922: 7405, 923: 5315, 924: 4752, 925: 6702, 926: 7260, 927: 6562, 928: 8014, 929: 5815, 930: 7150, 931: 3588, 932: 7395, 933: 7331, 934: 6763, 935: 5650, 936: 7056, 937: 7232, 938: 9408, 939: 5977, 940: 7252, 941: 5030, 942: 6058, 943: 6969, 944: 7930, 945: 4374, 946: 4203, 947: 8392, 948: 6944, 949: 5350, 950: 5742, 951: 7776, 952: 6568, 953: 5323, 954: 6966, 955: 4719, 956: 3855, 957: 7898, 958: 4244, 959: 7051, 960: 6723, 961: 6521, 962: 6690, 963: 10764, 964: 9759, 965: 8484, 966: 4818, 967: 8641, 968: 7191, 969: 3503, 970: 3295, 971: 8280, 972: 3422, 973: 6440, 974: 11540, 975: 7715, 976: 6974, 977: 4774, 978: 7213, 979: 6264, 980: 7019, 981: 7308, 982: 8058, 983: 10286, 984: 6067, 985: 8387, 986: 6228, 987: 6847, 988: 4698, 989: 5242, 990: 6409, 991: 5756, 992: 5715, 993: 7618, 994: 4539, 995: 9264, 996: 6510, 997: 5157, 998: 4316, 999: 9183, 1000: 7452, 1001: 5420, 1002: 6063, 1003: 7382, 1004: 5165, 1005: 6205, 1006: 6371, 1007: 6996, 1008: 5331, 1009: 4772, 1010: 8874, 1011: 7878, 1012: 6049, 1013: 3993, 1014: 12206, 1015: 6040, 1016: 5409, 1017: 7222, 1018: 11748, 1019: 9071, 1020: 9032, 1021: 8877, 1022: 7325, 1023: 6152, 1024: 6135, 1025: 7425, 1026: 9495, 1027: 13104, 1028: 4732, 1029: 5416, 1030: 3610, 1031: 4843, 1032: 9195, 1033: 13865, 1034: 6503, 1035: 4876, 1036: 4986, 1037: 6906, 1038: 5897, 1039: 8202, 1040: 8697, 1041: 6111, 1042: 4131, 1043: 8792, 1044: 6622, 1045: 7535, 1046: 8698, 1047: 4885, 1048: 6887, 1049: 3985, 1050: 7389, 1051: 7490, 1052: 7269, 1053: 8932, 1054: 6034, 1055: 7914, 1056: 3877, 1057: 6423, 1058: 7263, 1059: 8424, 1060: 7327, 1061: 7378, 1062: 6405, 1063: 4271, 1064: 9455, 1065: 4198, 1066: 11073, 1067: 5756, 1068: 4441, 1069: 6305, 1070: 7034, 1071: 6027, 1072: 6821, 1073: 7276, 1074: 5146, 1075: 11485, 1076: 3620, 1077: 4489, 1078: 6808, 1079: 8685, 1080: 10190, 1081: 5924, 1082: 7044, 1083: 5146, 1084: 6271, 1085: 7567, 1086: 7677, 1087: 6282, 1088: 5084, 1089: 10160, 1090: 6453, 1091: 8276, 1092: 11960, 1093: 8338, 1094: 4574, 1095: 4781, 1096: 5456, 1097: 9744, 1098: 5259, 1099: 7743, 1100: 5419, 1101: 9972, 1102: 6999, 1103: 5019, 1104: 5461, 1105: 4564, 1106: 4894, 1107: 6231, 1108: 5746, 1109: 4927, 1110: 4531, 1111: 5251, 1112: 10236, 1113: 6627, 1114: 20666, 1115: 6302}

for i in range(1500):
    store[i]=[]

with open('data/train.csv', 'rb') as csvfile:
    spamreader = csv.reader(csvfile, delimiter=',', quotechar='"')
    spamreader.next()
    for row in spamreader:
        row.append(storeMean[int(row[0])])
        data.append(row)
        if int(row[3])!=0:
            store[int(row[0])].append(int(row[3]))

with open('data/trainPreProc.csv', 'wb') as csvfile:
    writer = csv.writer(csvfile)
    for d in data:
        writer.writerow(d)

''' Store mean is calculated this way
for i in store.keys():
    if (store[i]!= []):
        sum = 0
        for j in store[i]:
            sum+=j
        storeMean[i]= sum/len(store[i])
print storeMean
'''
